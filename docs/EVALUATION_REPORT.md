# rusty_bot æŠ€æœ¯è¯„ä¼°æŠ¥å‘Š

## 1. é¡¹ç›®æ¦‚è¿°

| å±æ€§ | å€¼ |
|------|-----|
| **é¡¹ç›®åç§°** | rusty_bot |
| **ä½œè€…** | Alejandro LÃ³pez MartÃ­nez |
| **åè®®** | GPL-3.0-or-later |
| **Rust ç‰ˆæœ¬** | 2021 edition |
| **é¡¹ç›®ç±»å‹** | å­¦æœ¯æ¯•ä¸šè®¾è®¡é¡¹ç›® |

---

## 2. æŠ€æœ¯æ ˆåˆ†æ

### 2.1 æ ¸å¿ƒä¾èµ–

| ç»„ä»¶ | æŠ€æœ¯æ–¹æ¡ˆ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|----------|------|------|
| **å‰ç«¯æ¡†æ¶** | Dioxus | 0.7.2 | å…¨æ ˆ Rust Web æ¡†æ¶ |
| **LLM å¼•æ“** | Kalosm (Qwen 2.5 7B) | git | æœ¬åœ° LLM æ¨ç† |
| **å‘é‡æ•°æ®åº“** | SurrealDB | 2.3.3 | åµŒå…¥å¼å‘é‡å­˜å‚¨ |
| **Embedding** | BERT (via Kalosm) | - | æ–‡æœ¬å‘é‡åŒ– |
| **Markdown** | Comrak | 0.39.0 | Markdown æ¸²æŸ“ |
| **å¼‚æ­¥è¿è¡Œæ—¶** | Tokio | 1.45.1 | å¼‚æ­¥ä»»åŠ¡å¤„ç† |
| **WASM ç»‘å®š** | wasm-bindgen | 0.2.100 | Web å¹³å°æ”¯æŒ |

### 2.2 Feature Flags

```toml
[features]
default = []
web = ["dioxus/web"]
desktop = ["dioxus/desktop"]
mobile = ["dioxus/mobile"]
server = ["dioxus/server", "dep:kalosm", "dep:surrealdb"]
```

---

## 3. æ¶æ„åˆ†æ

### 3.1 ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Dioxus Web UI                         â”‚
â”‚              (WASM, TailwindCSS, å“åº”å¼)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ Server Functions (#[get], #[post], #[server])
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Axum Server                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     LLM æ¨¡å—      â”‚         Embedding æ¨¡å—                â”‚
â”‚  (Qwen 2.5 7B)   â”‚          (BERT)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              SurrealDB (å‘é‡æ£€ç´¢)                         â”‚
â”‚         SemanticChunker + DocumentTable                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ä»£ç ç»“æ„

```
src/
â”œâ”€â”€ main.rs                    # å…¥å£ç‚¹
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ mod.rs
â”‚   â”œâ”€â”€ conversation.rs        # å¯¹è¯ç»„ä»¶
â”‚   â””â”€â”€ message.rs             # æ¶ˆæ¯æ¸²æŸ“
â”œâ”€â”€ model/
â”‚   â”œâ”€â”€ mod.rs
â”‚   â”œâ”€â”€ chat.rs                # èŠå¤©æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ document.rs            # æ–‡æ¡£æ¨¡å‹
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ mod.rs
â”‚   â”œâ”€â”€ llm.rs                 # LLM æ¨ç†
â”‚   â”œâ”€â”€ embedding.rs           # æ–‡æœ¬åµŒå…¥
â”‚   â””â”€â”€ database_impl.rs       # æ•°æ®åº“æ“ä½œ
â””â”€â”€ server_functions/
    â””â”€â”€ server_functions.rs    # Dioxus æœåŠ¡å™¨å‡½æ•°
```

---

## 4. æ ¸å¿ƒåŠŸèƒ½å®ç°

### 4.1 RAG å®ç° (`database_impl.rs`)

- **SemanticChunker**: å¯¹æ–‡æ¡£è¿›è¡Œè¯­ä¹‰åˆ†å—
- **DocumentTable**: åŸºäº Embedding çš„æ–‡æ¡£å­˜å‚¨
- **çŸ¥è¯†åº“åŠ è½½**: ä» `./context` ç›®å½•åŠ è½½ Markdown æ–‡ä»¶
- **ç›¸ä¼¼åº¦æ£€ç´¢**: åŸºäºå‘é‡ç›¸ä¼¼åº¦çš„ä¸Šä¸‹æ–‡æ£€ç´¢

### 4.2 LLM æ¨ç† (`llm.rs`)

```rust
// æ¨¡å‹é…ç½®
Model: Qwen 2.5 7B Instruct
Temperature: 0.7
Top P: 0.9
Max Length: 600
```

- **æµå¼å“åº”**: å®æ—¶ token-by-token è¾“å‡º
- **ä¼šè¯ç®¡ç†**: å•ä¾‹æ¨¡å¼çš„ Chat Session
- **çŠ¶æ€é‡ç½®**: æ”¯æŒå¯¹è¯å†å²æ¸…ç©º

### 4.3 Server Functions

| å‡½æ•° | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| `init_llm_model` | `#[server]` | åˆå§‹åŒ– LLM |
| `init_embedding_model` | `#[server]` | åˆå§‹åŒ– Embedding |
| `init_db` | `#[server]` | åˆå§‹åŒ–æ•°æ®åº“ |
| `get_response` | `#[get("/api/get_response")]` | æµå¼å“åº” |
| `search_context` | `#[server]` | ä¸Šä¸‹æ–‡æ£€ç´¢ |
| `reset_chat` | `#[server]` | é‡ç½®å¯¹è¯ |

---

## 5. ä¼˜ç¼ºç‚¹åˆ†æ

### 5.1 ä¼˜ç‚¹

| ä¼˜ç‚¹ | è¯´æ˜ |
|------|------|
| âœ… å…¨æ ˆ Rust | å‰åç«¯ç»Ÿä¸€è¯­è¨€ï¼Œç±»å‹å®‰å…¨ |
| âœ… é›¶ JS ä¾èµ– | æ ¸å¿ƒé€»è¾‘æ— éœ€ JavaScript |
| âœ… æ¨¡å—åŒ–è®¾è®¡ | æ¸…æ™°çš„ server/model/components åˆ†å±‚ |
| âœ… æµå¼å“åº” | è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ |
| âœ… æœ¬åœ° LLM | æ— éœ€å¤–éƒ¨ APIï¼Œéšç§å‹å¥½ |
| âœ… RAG æ”¯æŒ | å†…ç½®çŸ¥è¯†åº“æ£€ç´¢å¢å¼º |

### 5.2 é—®é¢˜ä¸é£é™©

| é—®é¢˜ | ä¸¥é‡ç¨‹åº¦ | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|------|----------|
| **ç‰ˆæœ¬å…¼å®¹æ€§** | âš ï¸ å·²è§£å†³ | dioxus-cli 0.7.2 ä¸ dioxus 0.6.3 ä¸å…¼å®¹ | å‡çº§è‡³ dioxus 0.7.2 |
| **èµ„æºéœ€æ±‚** | ğŸ”´ é«˜ | éœ€è¦ 8-16GB RAMï¼Œæ¨¡å‹ ~10GB å­˜å‚¨ | æä¾›æ¨¡å‹é€‰æ‹© |
| **Kalosm git ä¾èµ–** | ğŸŸ¡ ä¸­ | éç¨³å®šç‰ˆæœ¬ï¼Œå¯èƒ½å­˜åœ¨ breaking changes | è¿ç§»è‡³ crates.io ç‰ˆæœ¬ |
| **å•ä¾‹æ¨¡å¼** | ğŸŸ¡ ä¸­ | `OnceCell<Mutex<>>` å…¨å±€çŠ¶æ€ï¼Œå¹¶å‘å—é™ | è€ƒè™‘è¿æ¥æ±  |
| **æ•°æ®åº“é‡å»º** | ğŸŸ¢ ä½ | æ¯æ¬¡å¯åŠ¨æ¸…ç©ºæ—§æ•°æ®åº“ | æ·»åŠ æŒä¹…åŒ–é€‰é¡¹ |

---

## 6. Dioxus 0.7 å‡çº§è®°å½•

### 6.1 å‡çº§åˆ†æ”¯

| åˆ†æ”¯ | è¯´æ˜ |
|------|------|
| `main` | åŸå§‹ç‰ˆæœ¬ + unused imports ä¿®å¤ |
| `baseline-0.6.3` | Dioxus 0.6.3 ç¨³å®šåŸºçº¿ |
| `upgrade/dioxus-0.7` | Dioxus 0.7.2 å‡çº§ç‰ˆæœ¬ âœ… |

### 6.2 å…³é”®æ›´æ”¹

1. **Cargo.toml**
   - `dioxus 0.6.3` â†’ `0.7.2`
   - æ·»åŠ  `server_fn = "0.7"`

2. **message.rs**
   - `ReadOnlySignal` â†’ `ReadSignal`

3. **server_functions.rs**
   - `#[server(output = StreamingText)]` â†’ `#[get("/api/...")]`
   - `use dioxus::fullstack::TextStream`
   - æ–°çš„é”™è¯¯å¤„ç†æ¨¡å¼

4. **conversation.rs**
   - ç§»é™¤ `.into_inner()` è°ƒç”¨

### 6.3 æäº¤å†å²

```
7732ebb refactor: update stream handling for dioxus 0.7
600529d refactor: migrate server functions to dioxus 0.7 API
afaa477 refactor: ReadOnlySignal â†’ ReadSignal
45d92b1 chore: upgrade dioxus from 0.6.3 to 0.7.2
e688fbf chore: fix unused imports warnings
```

---

## 7. è¿è¡ŒæŒ‡å—

### 7.1 ç¯å¢ƒè¦æ±‚

- Rust 1.75+
- dioxus-cli 0.7.2
- 8-16GB RAM
- ~10GB ç£ç›˜ç©ºé—´ï¼ˆæ¨¡å‹ï¼‰

### 7.2 æ„å»ºä¸è¿è¡Œ

```bash
# å®‰è£… dioxus-cli
cargo install dioxus-cli

# å¼€å‘æ¨¡å¼
dx serve --platform web

# ç”Ÿäº§æ„å»º
dx build --platform web --release

# è®¿é—®
open http://localhost:8080
```

### 7.3 é¦–æ¬¡è¿è¡Œ

é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ä¸‹è½½ Qwen 2.5 7B æ¨¡å‹ï¼ˆçº¦ 10GBï¼‰ï¼Œè¯·ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®šã€‚

---

## 8. æ”¹è¿›å»ºè®®

### 8.1 çŸ­æœŸæ”¹è¿›

1. **Kalosm ç¨³å®šç‰ˆ**: è¿ç§»è‡³ crates.io æ­£å¼ç‰ˆæœ¬
2. **é”™è¯¯å¤„ç†**: å¢å¼ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
3. **é…ç½®å¤–éƒ¨åŒ–**: æ¨¡å‹å‚æ•°ã€æ•°æ®åº“è·¯å¾„ç­‰é…ç½®å¤–éƒ¨åŒ–

### 8.2 ä¸­æœŸæ”¹è¿›

1. **æ¨¡å‹é€‰æ‹©**: æ”¯æŒå¤šç§æ¨¡å‹ï¼ˆ7B/13B/å°æ¨¡å‹ï¼‰
2. **æ•°æ®æŒä¹…åŒ–**: æ”¯æŒå¯¹è¯å†å²ä¿å­˜
3. **å¤šä¼šè¯**: æ”¯æŒå¤šä¸ªå¯¹è¯ä¼šè¯

### 8.3 é•¿æœŸæ”¹è¿›

1. **è·¨å¹³å°**: Desktop/Mobile æ”¯æŒ
2. **æ’ä»¶ç³»ç»Ÿ**: æ”¯æŒè‡ªå®šä¹‰å·¥å…·å’Œæ’ä»¶
3. **å¤šæ¨¡æ€**: å›¾åƒç†è§£ã€è¯­éŸ³æ”¯æŒ

---

## 9. ç»“è®º

rusty_bot æ˜¯ä¸€ä¸ª**æ•™è‚²æ€§è´¨çš„ RAG èŠå¤©æœºå™¨äººåŸå‹**ï¼Œå±•ç¤ºäº†å¦‚ä½•ç”¨çº¯ Rust æ„å»ºï¼š
- æœ¬åœ° LLM æ¨ç†
- è¯­ä¹‰å‘é‡æ£€ç´¢
- å…¨æ ˆ Web åº”ç”¨

ä½œä¸ºå­¦ä¹ é¡¹ç›®å…·æœ‰è‰¯å¥½çš„å‚è€ƒä»·å€¼ï¼Œä½†è·ç¦»ç”Ÿäº§ç¯å¢ƒè¿˜éœ€åœ¨é”™è¯¯å¤„ç†ã€å¹¶å‘æ”¯æŒã€æŒä¹…åŒ–å­˜å‚¨ç­‰æ–¹é¢è¿›è¡Œå®Œå–„ã€‚

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025-12-07*
*Dioxus ç‰ˆæœ¬: 0.7.2*
*è¯„ä¼°åˆ†æ”¯: upgrade/dioxus-0.7*
